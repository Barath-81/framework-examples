<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>new (Spreadsheet::Cell)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File lib/spreadsheet.rb, line 580</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">sheet</span>, <span class="ruby-identifier">record_index</span>, <span class="ruby-identifier">cell_index</span>)
      <span class="ruby-ivar">@sheet</span>       = <span class="ruby-identifier">sheet</span>
      <span class="ruby-ivar">@book</span>        = <span class="ruby-identifier">sheet</span>.<span class="ruby-identifier">book</span>
      <span class="ruby-ivar">@o</span>           = <span class="ruby-identifier">sheet</span>.<span class="ruby-identifier">ole_object</span>
      <span class="ruby-ivar">@cellindex</span>   = <span class="ruby-identifier">cell_index</span>
      <span class="ruby-ivar">@recordindex</span> = <span class="ruby-identifier">record_index</span>
      <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@sheet</span>.<span class="ruby-identifier">style</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:row</span>
        <span class="ruby-ivar">@row</span> = <span class="ruby-ivar">@recordindex</span> 
        <span class="ruby-ivar">@col</span> = <span class="ruby-ivar">@cellindex</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@sheet</span>.<span class="ruby-identifier">firstcol</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt"># taking into account the start of the used data range</span>
        <span class="ruby-ivar">@cell</span> = <span class="ruby-ivar">@o</span>.<span class="ruby-constant">Cells</span>(<span class="ruby-ivar">@row</span>,<span class="ruby-ivar">@col</span>)
        <span class="ruby-ivar">@value</span> = <span class="ruby-ivar">@cell</span>.<span class="ruby-constant">Value</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:col</span>
        <span class="ruby-ivar">@row</span> = <span class="ruby-ivar">@cellindex</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@sheet</span>.<span class="ruby-identifier">firstrow</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> <span class="ruby-comment cmt"># taking into account the start of the used data range</span>
        <span class="ruby-ivar">@col</span> = <span class="ruby-ivar">@recordindex</span> 
        <span class="ruby-ivar">@cell</span> = <span class="ruby-ivar">@o</span>.<span class="ruby-constant">Cells</span>(<span class="ruby-ivar">@row</span>,<span class="ruby-ivar">@col</span>)
        <span class="ruby-ivar">@value</span> = <span class="ruby-ivar">@cell</span>.<span class="ruby-constant">Value</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-comment cmt"># Ignore blank values. There's not much use for cells </span>
      <span class="ruby-comment cmt"># that are not set so skip them and normalize the return </span>
      <span class="ruby-comment cmt"># to nil so we know that's the case</span>
      <span class="ruby-ivar">@value</span> = <span class="ruby-ivar">@value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@value</span> <span class="ruby-operator">==</span> <span class="ruby-value str">''</span>
        <span class="ruby-ivar">@value</span> = <span class="ruby-keyword kw">nil</span> 
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@value</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">ARRAY</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@value</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">HASH</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@value</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">BOOL</span> 
        <span class="ruby-ivar">@value</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-ivar">@value</span>)
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@value</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">NUMBER</span>
        <span class="ruby-comment cmt">#handle Excel conversion of integer to float</span>
        <span class="ruby-ivar">@value</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp re">/\.0\Z/</span>,<span class="ruby-value str">''</span>) 
        <span class="ruby-ivar">@value</span> = <span class="ruby-identifier">eval</span>(<span class="ruby-ivar">@value</span>)
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-comment cmt">#TODO: find a way to add other handlers</span>
      <span class="ruby-comment cmt">#if @value =~ /(\d{4})\/(\d{2})\/(\d{2}) \d{2}:\d{2}:\d{2}$/  # handle excel automatic handling of dates</span>
       <span class="ruby-comment cmt">#  @value = &quot;#{$2}/#{$3}/#{$1}&quot;</span>
      <span class="ruby-comment cmt">#end</span>
      
      <span class="ruby-comment cmt"># Put together the cell's name</span>
      <span class="ruby-identifier">column_letter</span> = <span class="ruby-ivar">@sheet</span>.<span class="ruby-identifier">colname</span>(<span class="ruby-ivar">@col</span>)
      <span class="ruby-ivar">@name</span> = <span class="ruby-identifier">column_letter</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">to_s</span>
      
      <span class="ruby-comment cmt"># The recordid is the row/col for the record</span>
      <span class="ruby-keyword kw">case</span> <span class="ruby-ivar">@sheet</span>.<span class="ruby-identifier">style</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:row</span>
        <span class="ruby-ivar">@recordid</span> = <span class="ruby-ivar">@row</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:col</span>
        <span class="ruby-ivar">@recordid</span> = <span class="ruby-identifier">column_letter</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
</body>
</html>